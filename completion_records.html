<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>完工记录 - 堆场验箱系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/mobile-app-style.css">
    <style>
        body {
            max-width: 430px;
            min-height: 1020px;
            height: 1020px;
            margin: 0 auto;
            position: relative;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow-y: auto;
        }
        
        .aspect-square {
            position: relative;
            padding-bottom: 100%;
        }
        
        .aspect-square img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .app-bottom-nav {
            max-width: 430px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <!-- 顶部状态栏 -->
    <div class="app-status-bar">
        <div>9:41</div>
        <div class="flex items-center space-x-2">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>
    
    <!-- 头部 -->
    <div class="app-header">
        <a href="../repair_completion.html" class="app-back-button">
            <i class="fas fa-arrow-left text-gray-600"></i>
        </a>
        <h1 class="app-header-title">完工记录</h1>
    </div>
    
    <!-- 主内容区域 -->
    <div class="app-content">
        <!-- 集装箱信息卡片 -->
        <div class="app-card">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold text-gray-800">集装箱信息</h2>
                <span class="px-2 py-1 bg-green-100 text-green-600 text-xs rounded-full">已修好</span>
            </div>
            
            <div class="mb-2">
                <span class="text-xl font-medium text-blue-600">MSCU-123456-7</span>
                <span class="ml-2 text-sm text-gray-500">箱号数字: 1234567</span>
            </div>
            
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500">级别</span>
                    <span class="font-medium text-gray-800">M（中等）</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500">箱属</span>
                    <span class="font-medium text-gray-800">MSC</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500">尺寸箱型</span>
                    <span class="font-medium text-gray-800">40尺高柜</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500">堆场位置</span>
                    <span class="font-medium text-gray-800">A区-12-05</span>
                </div>
            </div>
        </div>
        
        <!-- 维修状态卡片 -->
        <div class="app-card">
            <h2 class="font-semibold text-gray-800 mb-3">维修状态概览</h2>
            
            <div class="mb-3 pb-3 border-b border-gray-100">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm text-gray-700">状态</span>
                    <span class="text-sm font-medium text-green-600">已修好</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-700">项目完成率</span>
                    <span class="text-sm font-medium text-gray-800">4/4 (100%)</span>
                </div>
            </div>
            
            <div class="space-y-2">
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                    <span class="text-sm text-gray-700">右侧板更换</span>
                    <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">已完成</span>
                </div>
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                    <span class="text-sm text-gray-700">顶板密封处理</span>
                    <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">已完成</span>
                </div>
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                    <span class="text-sm text-gray-700">门铰链紧固</span>
                    <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">已完成</span>
                </div>
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                    <span class="text-sm text-gray-700">地板修复</span>
                    <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">已完成</span>
                </div>
            </div>
        </div>
        
        <!-- 完工详细记录 -->
        <div class="app-card">
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-semibold text-gray-800">完工详细记录</h2>
                <button id="edit-records-btn" class="bg-blue-500 text-white px-3 py-1.5 rounded-lg text-sm flex items-center">
                    <i class="fas fa-edit mr-1"></i> 编辑记录
                </button>
            </div>
            
            <div id="view-mode" class="space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-check text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">完工日期</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">2023-06-15</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">完工时间</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">14:45</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-user-check text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">维修人员</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">张工程师, 李技师</span>
                </div>
                
           
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-users text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">施工人数</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">2 人</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">质检结果</span>
                    </div>
                    <span class="text-sm font-medium text-green-600">合格</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-file-invoice text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">维修单号</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">WX20230615001</span>
                </div>
                
              
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-signature text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">质检人员</span>
                    </div>
                    <span class="text-sm font-medium text-gray-800">王质检</span>
                </div>
              
            </div>

            <!-- 编辑模式 -->
            <div id="edit-mode" class="space-y-3 hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-check text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">完工日期</span>
                    </div>
                    <input type="date" class="p-1.5 border border-gray-200 rounded text-sm w-36" value="2023-06-15">
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">完工时间</span>
                    </div>
                    <input type="time" class="p-1.5 border border-gray-200 rounded text-sm w-36" value="14:45">
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-user-check text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">维修人员</span>
                    </div>
                    <input type="text" class="p-1.5 border border-gray-200 rounded text-sm w-36" value="张工程师, 李技师">
                </div>
                
             
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-users text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">施工人数</span>
                    </div>
                    <div class="flex items-center w-36">
                        <input type="number" class="p-1.5 border border-gray-200 rounded text-sm w-20 text-right" value="2" min="1" max="20">
                        <span class="ml-2 text-sm text-gray-500">人</span>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">质检结果</span>
                    </div>
                    <select class="p-1.5 border border-gray-200 rounded text-sm w-36">
                        <option value="pass" selected>合格</option>
                        <option value="conditional">有条件合格</option>
                        <option value="fail">不合格</option>
                    </select>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-file-invoice text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">维修单号</span>
                    </div>
                    <input type="text" class="p-1.5 border border-gray-200 rounded text-sm w-36 bg-gray-50" value="WX20230615001" readonly>
                </div>
                
            
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-signature text-gray-400 w-5"></i>
                        <span class="text-sm text-gray-700 ml-2">质检人员</span>
                    </div>
                    <input type="text" class="p-1.5 border border-gray-200 rounded text-sm w-36" value="王质检">
                </div>

                <div class="flex justify-end mt-4 space-x-2">
                    <button id="cancel-edit-btn" class="app-button-secondary px-3 py-1.5 rounded-lg text-sm">取消</button>
                    <button id="save-edit-btn" class="app-button px-3 py-1.5 rounded-lg text-sm">保存</button>
                </div>
            </div>
        </div>
        
        <!-- 维修备注 -->
        <div class="app-card">
            <h2 class="font-semibold text-gray-800 mb-2">维修备注</h2>
            <div class="text-sm text-gray-700 border-l-2 border-gray-300 pl-3 py-2">
                右侧板已完全更换，使用了加厚型钢板以增强耐用性。顶板漏水点共发现3处，均已密封处理。门铰链已紧固并更换了部分磨损的螺丝。地板损坏部分已完全修复。
            </div>
        </div>
        
        <!-- 维修照片 -->
        <div class="app-card">
            <h2 class="font-semibold text-gray-800 mb-3">维修照片</h2>
            
            <div class="grid grid-cols-3 gap-2">
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                    <img src="https://placehold.co/200x200/e5e7eb/a1a1aa?text=右侧板" alt="右侧板" class="w-full h-full object-cover">
                    <div class="mt-1 text-xs text-gray-500 text-center truncate">右侧板更换后</div>
                </div>
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                    <img src="https://placehold.co/200x200/e5e7eb/a1a1aa?text=顶板" alt="顶板" class="w-full h-full object-cover">
                    <div class="mt-1 text-xs text-gray-500 text-center truncate">顶板密封后</div>
                </div>
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                    <img src="https://placehold.co/200x200/e5e7eb/a1a1aa?text=门铰链" alt="门铰链" class="w-full h-full object-cover">
                    <div class="mt-1 text-xs text-gray-500 text-center truncate">门铰链紧固后</div>
                </div>
                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                    <img src="https://placehold.co/200x200/e5e7eb/a1a1aa?text=地板" alt="地板" class="w-full h-full object-cover">
                    <div class="mt-1 text-xs text-gray-500 text-center truncate">地板修复后</div>
                </div>
            </div>
        </div>
        
        <!-- 导出打印按钮 -->
        <div class="flex space-x-3 mb-8">
            <button class="app-button-secondary flex-1 py-3 rounded-xl font-medium flex items-center justify-center">
                <i class="fas fa-download mr-2"></i>导出PDF
            </button>
            <button class="app-button flex-1 py-3 rounded-xl font-medium shadow-md flex items-center justify-center">
                <i class="fas fa-print mr-2"></i>打印记录
            </button>
        </div>
    </div>
    
    <!-- 底部导航 -->
    <div class="app-bottom-nav">
        <a href="../home.html" class="app-nav-item">
            <i class="fas fa-home"></i>
            <span>首页</span>
        </a>
        <a href="../task_list.html" class="app-nav-item active">
            <i class="fas fa-list-alt"></i>
            <span>任务</span>
        </a>
        <a href="#" class="app-nav-item">
            <i class="fas fa-chart-bar"></i>
            <span>统计</span>
        </a>
        <a href="../settings.html" class="app-nav-item">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>
    
    <script>
        // 显示提示消息
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg text-sm z-50';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 2000);
        }
        
        // 给导出和打印按钮添加事件
        document.addEventListener('DOMContentLoaded', function() {
            const exportBtn = document.querySelector('.bg-gray-200.text-gray-700.py-3');
            const printBtn = document.querySelector('.bg-gray-600.text-white.py-3');
            const materialDetailBtn = document.querySelector('button[type="button"].p-1\\.5.text-blue-500');
            const editRecordsBtn = document.getElementById('edit-records-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const saveEditBtn = document.getElementById('save-edit-btn');
            const viewMode = document.getElementById('view-mode');
            const editMode = document.getElementById('edit-mode');
            
            // 编辑按钮事件
            if (editRecordsBtn) {
                editRecordsBtn.addEventListener('click', function() {
                    viewMode.classList.add('hidden');
                    editMode.classList.remove('hidden');
                    editRecordsBtn.classList.add('hidden');
                });
            }
            
            // 取消编辑按钮事件
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', function() {
                    viewMode.classList.remove('hidden');
                    editMode.classList.add('hidden');
                    editRecordsBtn.classList.remove('hidden');
                });
            }
            
            // 保存编辑按钮事件
            if (saveEditBtn) {
                saveEditBtn.addEventListener('click', function() {
                    // 获取表单数据
                    const dateInput = editMode.querySelector('input[type="date"]');
                    const timeInput = editMode.querySelector('input[type="time"]');
                    const staffInput = editMode.querySelector('input[value="张工程师, 李技师"]');
                    const hoursInput = editMode.querySelector('input[type="number"][min="0"][max="100"]');
                    const workersInput = editMode.querySelector('input[type="number"][min="1"][max="20"]');
                    const qualitySelect = editMode.querySelector('select');
                    const costInput = editMode.querySelector('input[type="number"][step="0.01"]');
                    const inspectorInput = editMode.querySelector('input[value="王质检"]');
                    
                    // 更新视图模式的值
                    const dateView = viewMode.querySelector('.fa-calendar-check + span + span');
                    const timeView = viewMode.querySelector('.fa-clock + span + span');
                    const staffView = viewMode.querySelector('.fa-user-check + span + span');
                    const hoursView = viewMode.querySelector('.fa-tasks + span + span');
                    const workersView = viewMode.querySelector('.fa-users + span + span');
                    const qualityView = viewMode.querySelector('.fa-check-circle + span + span');
                    const inspectorView = viewMode.querySelector('.fa-signature + span + span');
                    const costView = viewMode.querySelector('.fa-dollar-sign + span + span');
                    
                    if (dateInput && dateView) dateView.textContent = dateInput.value || '2023-06-15';
                    if (timeInput && timeView) timeView.textContent = timeInput.value || '14:45';
                    if (staffInput && staffView) staffView.textContent = staffInput.value || '张工程师, 李技师';
                    if (hoursInput && hoursView) hoursView.textContent = (hoursInput.value || '4') + ' 小时';
                    if (workersInput && workersView) workersView.textContent = (workersInput.value || '2') + ' 人';
                    
                    if (qualitySelect && qualityView) {
                        const qualityText = qualitySelect.options[qualitySelect.selectedIndex].text;
                        qualityView.textContent = qualityText;
                        
                        // 根据质检结果设置颜色
                        if (qualitySelect.value === 'pass') {
                            qualityView.className = 'text-sm font-medium text-green-600';
                        } else if (qualitySelect.value === 'conditional') {
                            qualityView.className = 'text-sm font-medium text-yellow-600';
                        } else {
                            qualityView.className = 'text-sm font-medium text-red-600';
                        }
                    }
                    
                    if (inspectorInput && inspectorView) inspectorView.textContent = inspectorInput.value || '王质检';
                    
                    if (costInput && costView) {
                        const costValue = parseFloat(costInput.value || '1200.00').toLocaleString('zh-CN', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                        costView.textContent = costValue + ' 元';
                    }
                    
                    // 切换回查看模式
                    viewMode.classList.remove('hidden');
                    editMode.classList.add('hidden');
                    editRecordsBtn.classList.remove('hidden');
                    
                    showToast('保存成功');
                });
            }
            
            exportBtn.addEventListener('click', function() {
                showToast('正在导出PDF文件...');
            });
            
            printBtn.addEventListener('click', function() {
                showToast('正在准备打印...');
                // 实际项目中会调用打印API
                // window.print();
            });
            
            if (materialDetailBtn) {
                materialDetailBtn.addEventListener('click', function() {
                    // 切换材料明细部分的显示/隐藏
                    const materialDetail = document.querySelector('h2.font-semibold.text-gray-800.mb-3:nth-of-type(4)').parentElement;
                    if (materialDetail.style.display === 'none') {
                        materialDetail.style.display = 'block';
                        this.innerHTML = '<i class="fas fa-eye-slash mr-1"></i>隐藏明细';
                    } else {
                        materialDetail.style.display = 'none';
                        this.innerHTML = '<i class="fas fa-eye mr-1"></i>查看明细';
                    }
                });
            }
            
            // 给照片添加点击预览功能
            const images = document.querySelectorAll('.aspect-square img');
            images.forEach(img => {
                img.addEventListener('click', function() {
                    showToast('查看照片：' + this.alt);
                });
            });
            
            // 添加输入限制
            const hoursInput = document.querySelector('input[type="number"][min="0"][max="100"]');
            if (hoursInput) {
                hoursInput.addEventListener('input', function() {
                    if (this.value < 0) this.value = 0;
                    if (this.value > 100) this.value = 100;
                });
            }
            
            const workersInput = document.querySelector('input[type="number"][min="1"][max="20"]');
            if (workersInput) {
                workersInput.addEventListener('input', function() {
                    if (this.value < 1) this.value = 1;
                    if (this.value > 20) this.value = 20;
                });
            }
            
            const costInput = document.querySelector('input[type="number"][step="0.01"]');
            if (costInput) {
                costInput.addEventListener('input', function() {
                    if (this.value < 0) this.value = 0;
                    // 格式化为两位小数
                    if (this.value && !isNaN(this.value)) {
                        this.value = parseFloat(this.value).toFixed(2);
                    }
                });
            }
        });
    </script>
</body>
</html> 